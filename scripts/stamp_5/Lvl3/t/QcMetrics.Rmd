---
output: html_document
editor_options: 
  chunk_output_type: console
---
```{r}
suppressPackageStartupMessages({
library(SingleCellExperiment)
library(tidyverse)
library(dplyr)
library(here)
library(scater)
library(scuttle)
library(glue)
library(qs)
library(parallel)
library(scran)
library(BiocParallel)
library(BiocNeighbors)
library(BiocSingular)
library(data.table)
})
```

```{r}
dir <- glue("{here()}")
source(glue("{dir}/scripts/misc/paths.R"))
source(glue("{dir}/scripts/misc/BIN.R"))
```

```{r}
sub <- "T"
res_dir <- paste0(proj_dir, "/data/stamp_5/processed/Lvl2/", sub)
sce <- qread(glue("{res_dir}/lvl2_sce.qs"), nthreads = 8)
```


```{r}
df <- as.data.frame(colData(sce))
```



```{r}
wh(15,8)
qc_metrics <- wrap_plots(
    plot_density(df, "sum", "lvl2", pal_lvl2_t, "Counts",200),
    plot_density(df, "detected", "lvl2", pal_lvl2_t, "Features",150),
    plot_density(df, "cell_area", "lvl2", pal_lvl2_t, "Cell Area",500),
    plot_density(df, "nucleus_area", "lvl2", pal_lvl2_t, "Nucleus Area",500),
    ncol = 2, nrow = 2) +
plot_annotation(tag_levels = "A")
```